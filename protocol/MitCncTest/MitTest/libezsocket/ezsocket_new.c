#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>
#ifndef _MSC_VER
#include <unistd.h>
#endif
#include <signal.h>
#include <sys/types.h>

#if defined(_WIN32)
# define OS_WIN32
/* ws2_32.dll has getaddrinfo and freeaddrinfo on Windows XP and later.
 * minwg32 headers check WINVER before allowing the use of these */
# ifndef WINVER
# define WINVER 0x0501
# endif
# include <ws2tcpip.h>
#else
# include <sys/socket.h>
# include <sys/ioctl.h>

#if defined(__OpenBSD__) || (defined(__FreeBSD__) && __FreeBSD__ < 5)
# define OS_BSD
# include <netinet/in_systm.h>
#endif

# include <netinet/in.h>
# include <netinet/ip.h>
# include <netinet/tcp.h>
# include <arpa/inet.h>
# include <poll.h>
# include <netdb.h>
#endif

#include "libezsocket/ezsocket_new.h"
#include "libezsocket/ezsocket_private.h"
#include "libezsocket/ezsocket_tcp_private.h"


#define _EZSOCKET_HEADER_LENGTH      12
#define _EZSOCKET_MAX_ADU_LENGTH     512


typedef struct
{
    char command[128];//命令
    uint16_t command_length;//命令的长度
}_ezsocket_command_t;


static char _ezsocket_run_status_command[] = {  0x16, 0x15, 0x14 };
static char _ezsocket_axis_commands[] = { 0x01, 0x02, 0x04 ,0x08};
static char _ezsocket_gcode_flag[] = { 0x01, 0x02, 0x03 , 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15  };

/* 返回的数据为小端模式 即低位在前 高位在后 */
static const _ezsocket_command_t _ezsocket_system_command[] =
{
    /* 系统相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb4, 0x43, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x59, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#版本1:43,版本2:44 版本信息
    // { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//系统日期
    // { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//系统时间
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//运行时间
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//循环时间
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//开始时间
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x02, 0x86, 0x05, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdc, 0x88, 0x03, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//经过的时间
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb4, 0x43, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xde, 0xd8, 0x02, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//心跳时间
};

static const _ezsocket_command_t _ezsocket_status_command[] =
{
    /* 状态相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x02, 0x86, 0x05, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdc, 0x88, 0x03, 0x00, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0xce, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//切削模式
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdc, 0x88, 0x03, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//#自动运行开始状态:14自动运行状态:15自动运行暂停状态:16 运行状态

};

static const _ezsocket_command_t _ezsocket_process_command[] =
{
    /* 加工相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x49, 0x00, 0x00, 0x01, 0x00, 0xb1, 0x04, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x58, 0xb1, 0x04, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x42, 0x1f, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//加工数量
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x03, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x5b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00, 0x65, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//程序名
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x3b, 0x00, 0x00, 0x01, 0x1f, 0xb5, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00, 0x66, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//序列号
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa4, 0x32, 0x00, 0x00, 0x01, 0x1f, 0xa8, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x43, 0x75, 0x72, 0x72, 0x65, 0x6e, 0x74, 0x50, 0x72, 0x67, 0x42, 0x6c, 0x6f, 0x63, 0x6b, 0x46, 0x69, 0x72, 0x73, 0x74, 0x00, 0x86, 0x2f, 0x05, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#10代表读10块 程序块

};
static const _ezsocket_command_t _ezsocket_axis_command[] =
{
    /* 轴相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd4, 0x0c, 0x00, 0x00, 0x01, 0x1f, 0xf4, 0x76, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00}, 80},//轴数量
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb8, 0x4d, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴02z轴04 当前坐标
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb8, 0x4d, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x1c, 0x5b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴02z轴04 工作坐标
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x4b, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdc, 0xc8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴02z轴04 剩余坐标
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x4b, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x18, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴02z轴04 机械坐标
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//主轴设定速度
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//主轴实际转速
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x52, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//进给设定速度 对应官方协议栈getfeedcommand
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x52, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//进给实际速度 对应官方协议栈getfeedcommand
    // public static string GET_SPINDLE_LOAD = "47494f50010001004400000000000000505200000100000004000000010000000d0000006d6f6368614765744461746100dfc402000000003f0000000400000000000000010000000000000003000000";//主轴负载
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x4b, 0x00, 0x00, 0x01, 0x50, 0xb1, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//主轴负载
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x46, 0x00, 0x00, 0x01, 0x50, 0xb1, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x0a, 0x00, 0xda, 0x00, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴.Y轴02z轴04 伺服负载
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x57, 0x4F, 0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x0a, 0x00, 0xda, 0x00, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//#坐标x轴01轴.Y轴02z轴04 伺服速度

};
static const _ezsocket_command_t _ezsocket_tool_command[] =
{
    /* 刀具相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x65, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//刀库刀具号
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2c, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0x1c, 0xb0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//主轴刀具号 getToolCommand
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2c, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x33, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//刀偏移 Dshape getToolCommand
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x0e, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//刀具补偿 D WEAR getToolCommand
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x0e, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x65, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//刀具补偿 H 0XFF表示轴名字 0x01表示第一个轴 0x02表示第二个 getToolCommand
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x57, 0x4F, 0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//刀具数量
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00}, 80},//刀具补偿类型
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x57, 0x4F, 0x06, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00}, 80},//刀具补偿的值 56代表刀具补偿类型 60开始4个字节代表刀具补偿值得种类和刀具编号

};
static const _ezsocket_command_t _ezsocket_modal_command[] =
{
    /* 模态相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF4, 0x12, 0x00, 0x00, 0x01, 0x57, 0xC8, 0x03, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//#M模态值 从第60个字节开始连续4个字节模态编号 小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF4, 0x12, 0x00, 0x00, 0x01, 0x57, 0xC8, 0x03, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//#S模态值 从第60个字节开始连续4个字节模态编号 小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF4, 0x12, 0x00, 0x00, 0x01, 0x57, 0xC8, 0x03, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x00, 0x00, 0x65, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//#T模态值 从第60个字节开始连续4个字节模态编号 小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF4, 0x12, 0x00, 0x00, 0x01, 0x57, 0xC8, 0x03, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//#B模态值 从第60个字节开始连续4个字节模态编号 小端序

};
static const _ezsocket_command_t _ezsocket_alarm_command[] =
{
    /* 报警相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x84, 0x27, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x43, 0x75, 0x72, 0x72, 0x65, 0x6e, 0x74, 0x41, 0x6c, 0x61, 0x72, 0x6d, 0x4d, 0x73, 0x67, 0x46, 0x69, 0x72, 0x73, 0x74, 0x00, 0x00, 0x4F, 0x06, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, 84},//报警信息

};
static const _ezsocket_command_t _ezsocket_plc_command[] =
{
    /* PLC相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x21, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdc, 0x88, 0x03, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00}, 80},//#Xc18,c18转10进制为3096,3096+1=3097,小端序转4byte为190c0000 输入点X 从第60个字节开始连续4个字节  小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x4a, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdf, 0x47, 0x03, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00}, 80},//#Yc18,c18转10进制为3096,3096+10000=13096,小端序转3byte为283300 输出点Y 从第60个字节开始连续4个字节  小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe8, 0x0b, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//#R20009,20009+500000=520009,小端序转3byte为49ef07 R寄存器 从第60个字节开始连续4个字节  小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x4a, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0xdf, 0x47, 0x03, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00}, 80},//#F48,48+40000=40048,小端序转3byte为709c00 F寄存器 从第60个字节开始连续4个字节 小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC8, 0x3B, 0x00, 0x00, 0x01, 0x57, 0x9B, 0x03, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00}, 80},//#D区 从第60个字节开始连续4个字节 第64 65为操作的数量 小端序
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x21, 0x00, 0x00, 0x01, 0x1f, 0x4a, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00}, 80},//#1-21 G代码

};
static const _ezsocket_command_t _ezsocket_param_command[] =
{
    /* 参数相关 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x49, 0x00, 0x00, 0x01, 0x00, 0xb1, 0x04, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x58, 0xb1, 0x04, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00}, 80},//参数读取

};

static const _ezsocket_command_t _ezsocket_macro_command[] =
{
    /* 宏变量 */
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x5c, 0x00, 0x00, 0x01, 0x1f, 0xb5, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0xFF, 0x03, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00}, 80},//100为20.101为21；102为22 宏变量 小于500
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd4, 0x42, 0x00, 0x00, 0x01, 0x50, 0x08, 0x77, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x47, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x8a, 0x50, 0x05, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0xFF, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00}, 80},//500为78;501为79 宏变量 大于500
    { { 0x47, 0x49, 0x4f, 0x50, 0x01, 0x00, 0x01, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x5c, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x6d, 0x6f, 0x63, 0x68, 0x61, 0x53, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0xFF, 0x03, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00}, 92}//{x}100为20.101为21；102为22 写宏变量的值

};



/* 数据解析 */
static int _ezsocket_decode_data_area(uint8_t *src)
{
    int rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,32);//总长度
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(src,src+36,rsp_length);
    return rsp_length;
}


/* 系统相关 */
static int _ezsocket_decode_version( uint8_t *src, uint8_t *dst, uint16_t *length)//版本信息
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    int i;
    int ptr;
    if(rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,0);
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    ptr = 0;
    for(i=0;i<rsp_length;i++)
    {
        if(src[4+i] != 0x00)
        {
            dst[ptr++] = src[4+i];
        }
    }
    *length = ptr;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_system_date(uint8_t *src, uint8_t *dst, uint16_t *length)//系统日期
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_system_time(uint8_t *src, uint8_t *dst, uint16_t *length)//系统时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 状态相关 */
static int _ezsocket_decode_cutting_model(uint8_t *src, uint8_t *dst, uint16_t *length)//切削模式
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_run_status(uint8_t *src, uint8_t *dst, uint16_t *length)//运行状态
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 加工相关 */
static int _ezsocket_decode_process_number(uint8_t *src, uint8_t *dst, uint16_t *length)//加工数量
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_program_no(uint8_t *src, uint8_t *dst, uint16_t *length)//程序号
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    int i;
    int ptr;
    if(rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,0);
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+4,rsp_length);
    /*ptr = 0;
    for(i=0;i<rsp_length;i++)
    {
        if(src[4+i] != 0x00)
        {
            dst[ptr++] = src[4+i];
        }
    }*/
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}


static int _ezsocket_decode_sequence_num(uint8_t *src, uint8_t *dst, uint16_t *length)//子程序号
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}


static int _ezsocket_decode_program_block(uint8_t *src, uint8_t *dst, uint16_t *length)//程序块内容
{
    int rsp_length;
    int i;
    int ptr;
    rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,36);//总长度
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(src,src+40,rsp_length);

    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+4,rsp_length);
    /* ptr = 0;
    for(i=0;i<rsp_length;i++)
    {
        if(src[4+i] != 0x00)
        {
            dst[ptr++] = src[4+i];
        }
    }*/
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_run_time(uint8_t *src, uint8_t *dst, uint16_t *length)//运行时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_cycle_time(uint8_t *src, uint8_t *dst, uint16_t *length)//循环时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_start_time(uint8_t *src, uint8_t *dst, uint16_t *length)//开始时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_estimate_time(uint8_t *src, uint8_t *dst, uint16_t *length)//外部经过的时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_keep_alive_time(uint8_t *src, uint8_t *dst, uint16_t *length)//上电时间
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 轴相关 */
static int _ezsocket_decode_axis_number(uint8_t *src, uint8_t *dst, uint16_t *length)//轴数量
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_current_position(uint8_t *src, uint8_t *dst, uint16_t *length)//当前坐标
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if( rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_work_position(uint8_t *src, uint8_t *dst, uint16_t *length)//工作坐标
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_distance_position(uint8_t *src, uint8_t *dst, uint16_t *length)//剩余坐标
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_machine_position(uint8_t *src, uint8_t *dst, uint16_t *length)//机械坐标
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_spindle_set_speed(uint8_t *src, uint8_t *dst, uint16_t *length)//主轴设定速度
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_spindle_act_speed(uint8_t *src, uint8_t *dst, uint16_t *length)//主轴实际速度
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_feed_set_speed(uint8_t *src, uint8_t *dst, uint16_t *length)//进给设定速度
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_feed_act_speed(uint8_t *src, uint8_t *dst, uint16_t *length)//进给实际速度
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_spindle_load(uint8_t *src, uint8_t *dst, uint16_t *length)//主轴负载
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_servo_load(uint8_t *src, uint8_t *dst, uint16_t *length)//伺服轴负载
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_servo_speed(uint8_t *src, uint8_t *dst, uint16_t *length)//伺服轴速度
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 刀具相关 */

static int _ezsocket_decode_mag_tool_no(uint8_t *src, uint8_t *dst, uint16_t *length)//主刀具号
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_spd_tool_no(uint8_t *src, uint8_t *dst, uint16_t *length)//主刀具号
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_offset_d_shape(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具补偿D shape
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_offset_d_wear(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具补偿D shape
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_offset_h(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具补偿H
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_set_size(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具数量
{
    int rsp_length = _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_offset_type(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具补偿得类型
{
    int rsp_length = _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_tool_offset_value(uint8_t *src, uint8_t *dst, uint16_t *length)//刀具补偿得类型
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length < 8 || rsp_length > 16)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length-8);
    *length = rsp_length-8;
    return EZSOCKET_RES_OK;
}

/* 模态相关 */
static int _ezsocket_decode_m_command(uint8_t *src, uint8_t *dst, uint16_t *length)//m command
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_s_command(uint8_t *src, uint8_t *dst, uint16_t *length)//s command
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_t_command(uint8_t *src, uint8_t *dst, uint16_t *length)//t command
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_b_command(uint8_t *src, uint8_t *dst, uint16_t *length)//b command
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 报警相关 */
static int _ezsocket_decode_alarm_msg(uint8_t *src, uint8_t *dst, uint16_t *length)//报警信息
{
    int i;
    int ptr;
    int temp_ptr;
    if(src[*length-1] == 0 && src[*length-2] == 0) //表示无报警
    {
        dst[0] = 0;
        dst[1] = 0;
        *length = 2;
        return EZSOCKET_RES_OK;
    }
    int rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,28);//总长度
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH || rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+32,rsp_length);
    /* ptr = 2;
    dst[ptr++] = 1;//报警数量
    dst[ptr++] = 0;//报警编号 缺省为0
    temp_ptr = ptr;//报警内容的长度+2
    ptr += 2;
    for(i=0;i<rsp_length;i++)
    {
        if(src[32+i] != 0x00)
        {
            dst[ptr++] = src[32+i];
        }
    }
    dst[temp_ptr++] = (ptr-5)>>8;//报警内容的长度 除去最开始的两个字节+报警编号长度+报警内容长度
    dst[temp_ptr++] = (ptr-5)&0xFF;//报警内容的长度*/
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* PLC 相关 */
static int _ezsocket_decode_plc_x(uint8_t *src, uint8_t *dst, uint16_t *length)//PLC X
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_plc_y(uint8_t *src, uint8_t *dst, uint16_t *length)//PLC Y
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_plc_r(uint8_t *src, uint8_t *dst, uint16_t *length)//PLC R
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_plc_f(uint8_t *src, uint8_t *dst, uint16_t *length)//PLC F
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_plc_d(uint8_t *src, uint8_t *dst, uint16_t *length)//PLC D
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0 || rsp_length > 4)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_g_code(uint8_t *src, uint8_t *dst, uint16_t *length)//G代码
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length > 8)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 参数读取 */
static int _ezsocket_decode_param_read(uint8_t *src, uint8_t *dst, uint16_t *length)//参数读取
{
    int rsp_length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(src,32);
    if(rsp_length > _EZSOCKET_MIN_REQ_LENGTH)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+36,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

/* 宏变量 */
static int _ezsocket_decode_read_macro_var(uint8_t *src, uint8_t *dst, uint16_t *length)//读取宏变量
{
    int rsp_length =  _ezsocket_decode_data_area(src);
    if(rsp_length <= 0)
        return EZSOCKET_RES_DECODE_ERR;
    memcpy(dst,src+8,rsp_length);
    *length = rsp_length;
    return EZSOCKET_RES_OK;
}

static int _ezsocket_decode_write_marco_var(uint8_t *src, uint8_t *dst)//写宏变量
{

}


//检查数据是否读写成功
static int _ezsocket_check_integrity(const ezsocket_t *ctx, const uint8_t *msg)
{
    uint16_t msg_length = (msg[2]<<8)+msg[3];//总长度
    if(msg_length >= 22)
    {
        if(msg[17] != 0x00 || msg[18] != 0x00 || msg[21] != 0xFF)
        {
            return EZSOCKET_RES_DECODE_ERR;
        }
    }
    else
    {
        return EZSOCKET_RES_DECODE_ERR;
    }
    return EZSOCKET_RES_OK;
}

/* 计算帧头以后有用数据的长度 */
static uint32_t _ezsocket_compute_meta_length_after_header(const uint8_t *data)
{
    int length;
    length = EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(data, 8);
    return length;
}

/* Builds a TCP request header
    funccode 要执行得功能 axis 轴编号 ， addr 要操作得地址 dnb 后面data得长度 req 生成得指令 data 要写入得数据
*/
int _ezsocket_build_request_basis(ezsocket_t *ctx,
                                  int function,
                                  int address,
                                  int nb,
                                  int src_nb,
                                  const uint8_t *src,
                                  uint8_t *req)
{
    int ptr = 0;
    switch(function)
    {
    /* 系统相关 */
    case _EZSOCKET_VERSION://版本信息
        memcpy(req,_ezsocket_system_command[_EZSOCKET_VERSION].command,_ezsocket_system_command[_EZSOCKET_VERSION].command_length);
        ptr += _ezsocket_system_command[_EZSOCKET_VERSION].command_length;
        break;
    case _EZSOCKET_RUN_TIME://运行时间
        memcpy(req,_ezsocket_system_command[_EZSOCKET_RUN_TIME].command,_ezsocket_system_command[_EZSOCKET_RUN_TIME].command_length);
        ptr += _ezsocket_system_command[_EZSOCKET_RUN_TIME].command_length;
        break;
    case _EZSOCKET_CYCLE_TIME://循环时间
        memcpy(req,_ezsocket_system_command[_EZSOCKET_CYCLE_TIME].command,_ezsocket_system_command[_EZSOCKET_CYCLE_TIME].command_length);
        ptr += _ezsocket_system_command[_EZSOCKET_CYCLE_TIME].command_length;
        break;
    case _EZSOCKET_START_TIME://开始时间
        memcpy(req,_ezsocket_system_command[_EZSOCKET_START_TIME].command,_ezsocket_system_command[_EZSOCKET_START_TIME].command_length);
        ptr += _ezsocket_system_command[_EZSOCKET_START_TIME].command_length;
        break;
    case _EZSOCKET_ESTIMATE_TIME://经过的时间
        memcpy(req,_ezsocket_system_command[_EZSOCKET_ESTIMATE_TIME].command,_ezsocket_system_command[_EZSOCKET_ESTIMATE_TIME].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_system_command[_EZSOCKET_ESTIMATE_TIME].command_length;
        break;
    case _EZSOCKET_KEEP_ALIVE_TIME://通电时间
        memcpy(req,_ezsocket_system_command[_EZSOCKET_KEEP_ALIVE_TIME].command,_ezsocket_system_command[_EZSOCKET_KEEP_ALIVE_TIME].command_length);
        ptr += _ezsocket_system_command[_EZSOCKET_KEEP_ALIVE_TIME].command_length;
        break;
        /* 状态相关 */
    case _EZSOCKET_CUTTING_MODEL://切削模式
        memcpy(req,_ezsocket_status_command[_EZSOCKET_CUTTING_MODEL-_EZSOCKET_CUTTING_MODEL].command,_ezsocket_status_command[_EZSOCKET_CUTTING_MODEL-_EZSOCKET_CUTTING_MODEL].command_length);
        ptr += _ezsocket_status_command[_EZSOCKET_CUTTING_MODEL-_EZSOCKET_CUTTING_MODEL].command_length;
        break;
    case _EZSOCKET_RUN_STATUS://运行状态
        memcpy(req,_ezsocket_status_command[_EZSOCKET_RUN_STATUS-_EZSOCKET_CUTTING_MODEL].command,_ezsocket_status_command[_EZSOCKET_RUN_STATUS-_EZSOCKET_CUTTING_MODEL].command_length);
        req[60] = _ezsocket_run_status_command[address];
        ptr += _ezsocket_status_command[_EZSOCKET_RUN_STATUS-_EZSOCKET_CUTTING_MODEL].command_length;
        break;
        /* 加工相关 */
    case _EZSOCKET_PROCESS_NUMBER://加工数量
        memcpy(req,_ezsocket_process_command[_EZSOCKET_PROCESS_NUMBER-_EZSOCKET_PROCESS_NUMBER].command,_ezsocket_process_command[_EZSOCKET_PROCESS_NUMBER-_EZSOCKET_PROCESS_NUMBER].command_length);
        ptr += _ezsocket_process_command[_EZSOCKET_PROCESS_NUMBER-_EZSOCKET_PROCESS_NUMBER].command_length;
        break;
    case _EZSOCKET_PROGRAM_NO://程序号
        memcpy(req,_ezsocket_process_command[_EZSOCKET_PROGRAM_NO-_EZSOCKET_PROCESS_NUMBER].command,_ezsocket_process_command[_EZSOCKET_PROGRAM_NO-_EZSOCKET_PROCESS_NUMBER].command_length);
        ptr += _ezsocket_process_command[_EZSOCKET_PROGRAM_NO-_EZSOCKET_PROCESS_NUMBER].command_length;
        break;
    case _EZSOCKET_SEQUENCE_NUM://程序块编号
        memcpy(req,_ezsocket_process_command[_EZSOCKET_SEQUENCE_NUM-_EZSOCKET_PROCESS_NUMBER].command,_ezsocket_process_command[_EZSOCKET_SEQUENCE_NUM-_EZSOCKET_PROCESS_NUMBER].command_length);
        ptr += _ezsocket_process_command[_EZSOCKET_SEQUENCE_NUM-_EZSOCKET_PROCESS_NUMBER].command_length;
        break;
    case _EZSOCKET_PROGRAM_BLOCK://程序块内容
        memcpy(req,_ezsocket_process_command[_EZSOCKET_PROGRAM_BLOCK-_EZSOCKET_PROCESS_NUMBER].command,_ezsocket_process_command[_EZSOCKET_PROGRAM_BLOCK-_EZSOCKET_PROCESS_NUMBER].command_length);
        ptr += _ezsocket_process_command[_EZSOCKET_PROGRAM_BLOCK-_EZSOCKET_PROCESS_NUMBER].command_length;
        break;
        /* 轴相关 */
    case _EZSOCKET_AXIX_NUMBER://轴数量
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_AXIX_NUMBER-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_AXIX_NUMBER-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_AXIX_NUMBER-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_CURRENT_POSITION://当前坐标
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_CURRENT_POSITION-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_CURRENT_POSITION-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_CURRENT_POSITION-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_WORK_POSITION://工作坐标
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_WORK_POSITION-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_WORK_POSITION-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_WORK_POSITION-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_DISTANCE_POSITION://剩余坐标
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_DISTANCE_POSITION-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_DISTANCE_POSITION-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_DISTANCE_POSITION-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_MACHINE_POSTION://机械坐标
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_MACHINE_POSTION-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_MACHINE_POSTION-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_MACHINE_POSTION-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_SPINDLE_SET_SPEED://主轴设定速度
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_SPINDLE_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_SPINDLE_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_SPINDLE_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_SPINDLE_ACTUAL_SPEED://主轴实际速度
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_SPINDLE_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_SPINDLE_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_SPINDLE_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_FEED_SET_SPEED://进给设定速度
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_FEED_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_FEED_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_FEED_SET_SPEED-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_FEED_ACTUAL_SPEED://进给实际速度
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_FEED_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_FEED_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_FEED_ACTUAL_SPEED-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_SPINDLE_LOAD://主轴负载
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_SPINDLE_LOAD-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_SPINDLE_LOAD-_EZSOCKET_AXIX_NUMBER].command_length);
        ptr += _ezsocket_axis_command[_EZSOCKET_SPINDLE_LOAD-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_SERVO_LOAD://伺服轴负载
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_SERVO_LOAD-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_SERVO_LOAD-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_SERVO_LOAD-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
    case _EZSOCKET_SERVO_SPEED://伺服轴负载
        memcpy(req,_ezsocket_axis_command[_EZSOCKET_SERVO_SPEED-_EZSOCKET_AXIX_NUMBER].command,_ezsocket_axis_command[_EZSOCKET_SERVO_SPEED-_EZSOCKET_AXIX_NUMBER].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_axis_command[_EZSOCKET_SERVO_SPEED-_EZSOCKET_AXIX_NUMBER].command_length;
        break;
        /* 刀具相关 */
    case _EZSOCKET_MAG_TOOL_NO://刀库刀具号
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_MAG_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_MAG_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_MAG_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_SPD_TOOL_NO://主轴刀具号
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_SPD_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_SPD_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_SPD_TOOL_NO-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOLOFFSET_D_SHAPE://刀具补偿D SHAPE
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_SHAPE-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_SHAPE-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_SHAPE-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOLOFFSET_D_WEAR://刀具补偿D SHAPE
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_WEAR-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_WEAR-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_D_WEAR-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOLOFFSET_H://刀具补偿H
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_H-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_H-_EZSOCKET_MAG_TOOL_NO].command_length);
        req[68] = ((uint16_t)(1<<address)&0xFFFF)&0xFF;
        req[69] = ((uint16_t)(1<<address)&0xFFFF)>>8;
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOLOFFSET_H-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOL_SET_SIZE://刀具数量
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOL_SET_SIZE-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOL_SET_SIZE-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOL_SET_SIZE-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOL_OFFSET_TYPE://刀具补偿得类型
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_TYPE-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_TYPE-_EZSOCKET_MAG_TOOL_NO].command_length);
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_TYPE-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
    case _EZSOCKET_TOOL_OFFSET_VALUE://刀具补偿值
        memcpy(req,_ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_VALUE-_EZSOCKET_MAG_TOOL_NO].command,_ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_VALUE-_EZSOCKET_MAG_TOOL_NO].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,56,nb);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_tool_command[_EZSOCKET_TOOL_OFFSET_VALUE-_EZSOCKET_MAG_TOOL_NO].command_length;
        break;
        /* 模态相关 */
    case _EZSOCKET_M_COMMAND://M COMMAND
        memcpy(req,_ezsocket_modal_command[_EZSOCKET_M_COMMAND-_EZSOCKET_M_COMMAND].command,_ezsocket_modal_command[_EZSOCKET_M_COMMAND-_EZSOCKET_M_COMMAND].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_modal_command[_EZSOCKET_M_COMMAND-_EZSOCKET_M_COMMAND].command_length;
        break;
    case _EZSOCKET_S_COMMAND://S COMMAND
        memcpy(req,_ezsocket_modal_command[_EZSOCKET_S_COMMAND-_EZSOCKET_M_COMMAND].command,_ezsocket_modal_command[_EZSOCKET_S_COMMAND-_EZSOCKET_M_COMMAND].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_modal_command[_EZSOCKET_S_COMMAND-_EZSOCKET_M_COMMAND].command_length;
        break;
    case _EZSOCKET_T_COMMAND://T COMMAND
        memcpy(req,_ezsocket_modal_command[_EZSOCKET_T_COMMAND-_EZSOCKET_M_COMMAND].command,_ezsocket_modal_command[_EZSOCKET_T_COMMAND-_EZSOCKET_M_COMMAND].command_length);
        ptr += _ezsocket_modal_command[_EZSOCKET_T_COMMAND-_EZSOCKET_M_COMMAND].command_length;
        break;
    case _EZSOCKET_B_COMMAND://B COMMAND
        memcpy(req,_ezsocket_modal_command[_EZSOCKET_B_COMMAND-_EZSOCKET_M_COMMAND].command,_ezsocket_modal_command[_EZSOCKET_B_COMMAND-_EZSOCKET_M_COMMAND].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_modal_command[_EZSOCKET_B_COMMAND-_EZSOCKET_M_COMMAND].command_length;
        break;
        /* 报警相关 */
    case _EZSOCKET_ALARM_MSG://报警信息
        memcpy(req,_ezsocket_alarm_command[_EZSOCKET_ALARM_MSG-_EZSOCKET_ALARM_MSG].command,_ezsocket_alarm_command[_EZSOCKET_ALARM_MSG-_EZSOCKET_ALARM_MSG].command_length);
        ptr += _ezsocket_alarm_command[_EZSOCKET_ALARM_MSG-_EZSOCKET_ALARM_MSG].command_length;
        break;
        /* PLC 相关 */
    case _EZSOCKET_PLC_X://PLC X
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_PLC_X-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_PLC_X-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_PLC_X-_EZSOCKET_PLC_X].command_length;
        break;
    case _EZSOCKET_PLC_Y://PLC Y
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_PLC_Y-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_PLC_Y-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_PLC_Y-_EZSOCKET_PLC_X].command_length;
        break;
    case _EZSOCKET_PLC_R://PLC R
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_PLC_R-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_PLC_R-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_PLC_R-_EZSOCKET_PLC_X].command_length;
        break;
    case _EZSOCKET_PLC_F://PLC F
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_PLC_F-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_PLC_F-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_PLC_F-_EZSOCKET_PLC_X].command_length;
        break;
    case _EZSOCKET_PLC_D://PLC D PLC的数据库存储区
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_PLC_D-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_PLC_D-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_PLC_D-_EZSOCKET_PLC_X].command_length;
        break;
    case _EZSOCKET_G_CODE://G代码
        memcpy(req,_ezsocket_plc_command[_EZSOCKET_G_CODE-_EZSOCKET_PLC_X].command,_ezsocket_plc_command[_EZSOCKET_G_CODE-_EZSOCKET_PLC_X].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_plc_command[_EZSOCKET_G_CODE-_EZSOCKET_PLC_X].command_length;
        break;
        /* 参数相关 */
    case _EZSOCKET_PARAM_READ://参数读取
        memcpy(req,_ezsocket_param_command[_EZSOCKET_PARAM_READ-_EZSOCKET_PARAM_READ].command,_ezsocket_param_command[_EZSOCKET_PARAM_READ-_EZSOCKET_PARAM_READ].command_length);
        EZSOCKET_SET_INT32_TO_INT8_LITTLE_ENDAIN(req,60,address);
        ptr += _ezsocket_param_command[_EZSOCKET_PARAM_READ-_EZSOCKET_PARAM_READ].command_length;
        break;
        /* 宏变量 */
    case _EZSOCKET_READ_MACRO_VAR://读取宏变量 宏变量的值小于500
        memcpy(req,_ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR].command,_ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR].command_length);
        req[60] = address & 0xFF;
        ptr += _ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR].command_length;
        break;
    case _EZSOCKET_READ_MACRO_VAR+1://读取宏变量 宏变量的值大于等于500
        memcpy(req,_ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR+1].command,_ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR+1].command_length);
        req[60] = address & 0xFF;
        ptr += _ezsocket_macro_command[_EZSOCKET_READ_MACRO_VAR-_EZSOCKET_READ_MACRO_VAR+1].command_length;
        break;
    case _EZSOCKET_WRITE_MACRO_VAR://写宏变量
        //memcpy(req,_ezsocket_command[_EZSOCKET_SEQUENCE_NUM].command,_ezsocket_command[_EZSOCKET_SEQUENCE_NUM].command_length);
        break;
    default:
        break;
    }
    return ptr;
}

int _ezsocket_receive_msg(const ezsocket_t *ctx, uint8_t *msg, uint16_t *length)
{
    int rc;
    fd_set rfds;
    struct timeval tv;
    struct timeval *p_tv;
    int length_to_read;
    int msg_length = 0;
    _ezsocket_step_t step;


    /* Add a file descriptor to the set */
    FD_ZERO(&rfds);
    FD_SET(ctx->s, &rfds);

    /* We need to analyse the message step by step.  At the first step, we want
     * to reach the function code because all packets contain this
     * information. */
    step = _EZSOCKET_STEP_HEADER;
    length_to_read = ctx->backend->header_length;

    tv.tv_sec = ctx->response_timeout.tv_sec;
    tv.tv_usec = ctx->response_timeout.tv_usec;
    p_tv = &tv;


    while (length_to_read != 0) {
        rc = ctx->backend->select(ctx, &rfds, p_tv, length_to_read);
        if (rc == -1) {
            //_error_print(ctx, "select");
            if (ctx->error_recovery & EZSOCKET_ERROR_RECOVERY_PROTOCOL) {
                int saved_errno = errno;

                if (errno == ETIMEDOUT) {
                    _ezsocket_sleep_and_flush(ctx);
                } else if (errno == EBADF) {
                    ezsocket_close(ctx);
                    ezsocket_connect(ctx);
                }
                errno = saved_errno;
            }
            return EZSOCKET_RES_TIMEOUT;
        }

        rc = ctx->backend->recv(ctx, msg + msg_length, length_to_read);
        if (rc == 0) {
            errno = ECONNRESET;
            rc = EZSOCKET_RES_TIMEOUT;
        }

        if (rc == -1) {
            //_error_print(ctx, "read");
            if ((ctx->error_recovery & EZSOCKET_ERROR_RECOVERY_PROTOCOL) &&
                    (errno == ECONNRESET || errno == ECONNREFUSED ||
                     errno == EBADF)) {
                int saved_errno = errno;
                ezsocket_close(ctx);
                ezsocket_connect(ctx);
                /* Could be removed by previous calls */
                errno = saved_errno;
            }
            return EZSOCKET_RES_TIMEOUT;
        }

        /* Display the hex code of each character received */
        if (ctx->debug) {
            int i;
            printf("recive:");
            for (i=0; i < rc; i++)
                printf("<%.2X>", msg[msg_length + i]);
        }

        /* Sums bytes received */
        msg_length += rc;
        /* Computes remaining bytes */
        length_to_read -= rc;

        if (length_to_read == 0) {
            switch (step) {
            case _EZSOCKET_STEP_HEADER:
                /* Function code position */
                length_to_read = _ezsocket_compute_meta_length_after_header(msg);
                if(length_to_read > ctx->backend->max_adu_length)
                {
                    //errno = EMBBADDATA;
                    //_error_print(ctx, "too many data");
                    _ezsocket_tcp_flush(ctx);
                    return EZSOCKET_RES_REV_TOO_LONG;
                }
                if (length_to_read != 0) {
                    step = _EZSOCKET_STEP_META;
                    break;
                } /* else switches straight to the next step */
            case _EZSOCKET_STEP_META:
                if ((msg_length + length_to_read) > ctx->backend->max_adu_length) {
                    //errno = EMBBADDATA;
                    //_error_print(ctx, "too many data");
                    return EZSOCKET_RES_REV_TOO_LONG;
                }
                step = _EZSOCKET_STEP_DATA;
                break;
            default:
                break;
            }
        }

        if (length_to_read > 0 && ctx->byte_timeout.tv_sec != -1) {
            /* If there is no character in the buffer, the allowed timeout
               interval between two consecutive bytes is defined by
               byte_timeout */
            tv.tv_sec = ctx->byte_timeout.tv_sec;
            tv.tv_usec = ctx->byte_timeout.tv_usec;
            p_tv = &tv;
        }
    }

    if (ctx->debug)
        printf("\n");

    *length = msg_length;

    if(0x00000000 != EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(msg,20) && msg_length > 60)
    {
        /* 系统返回错误码 */
        if (ctx->debug)
        {
            printf("system_errcode = 0x%X\r\n",EZSOCKET_GET_INT32_FROM_INT8_LITTLE_ENDAIN(msg,56));
            return  EZSOCKET_RES_SYSTEM_ERRCODE;
        }

    }


    return EZSOCKET_RES_OK;//_ezsocket_828d_check_integrity(ctx,msg);
}


static int _ezsocket_decode_msg(const ezsocket_t *ctx, uint8_t function, const uint8_t *msg, uint8_t *dest, uint16_t *length)
{
    int rc;
    switch(function)
    {
    /* 系统相关 */
    case _EZSOCKET_VERSION://版本信息
        rc = _ezsocket_decode_version(msg,dest,length);
        break;
        /* case _EZSOCKET_SYSTEM_DATE://系统日期
        rc = _ezsocket_decode_system_date(msg,dest,length);
        break;
    case _EZSOCKET_SYSTEM_TIME://系统时间
        rc = _ezsocket_decode_system_time(msg,dest,length);
        break;*/
        /* 状态相关 */
    case _EZSOCKET_CUTTING_MODEL://切削模式
        rc = _ezsocket_decode_cutting_model(msg,dest,length);
        break;
    case _EZSOCKET_RUN_STATUS://运行状态
        rc = _ezsocket_decode_run_status(msg,dest,length);
        break;
        /* 加工相关 */
    case _EZSOCKET_PROCESS_NUMBER://加工数量
        rc = _ezsocket_decode_process_number(msg,dest,length);
        break;
    case _EZSOCKET_PROGRAM_NO://程序号
        rc = _ezsocket_decode_program_no(msg,dest,length);
        break;
    case _EZSOCKET_SEQUENCE_NUM://执行的语句编号
        rc = _ezsocket_decode_sequence_num(msg,dest,length);
        break;
    case _EZSOCKET_PROGRAM_BLOCK://程序块内容
        rc = _ezsocket_decode_program_block(msg,dest,length);
        break;
    case _EZSOCKET_RUN_TIME://运行时间
        rc = _ezsocket_decode_run_time(msg,dest,length);
        break;
    case _EZSOCKET_CYCLE_TIME://循环时间
        rc = _ezsocket_decode_cycle_time(msg,dest,length);
        break;
    case _EZSOCKET_START_TIME://开始时间
        rc = _ezsocket_decode_start_time(msg,dest,length);
        break;
    case _EZSOCKET_ESTIMATE_TIME://经过的时间
        rc = _ezsocket_decode_estimate_time(msg,dest,length);
        break;
    case _EZSOCKET_KEEP_ALIVE_TIME://心跳时间
        rc = _ezsocket_decode_keep_alive_time(msg,dest,length);
        break;
        /* 轴相关 */
    case _EZSOCKET_AXIX_NUMBER://轴数量
        rc = _ezsocket_decode_axis_number(msg,dest,length);
        break;
    case _EZSOCKET_CURRENT_POSITION://当前坐标
        rc = _ezsocket_decode_current_position(msg,dest,length);
        break;
    case _EZSOCKET_WORK_POSITION://工作坐标
        rc = _ezsocket_decode_work_position(msg,dest,length);
        break;
    case _EZSOCKET_DISTANCE_POSITION://剩余坐标
        rc = _ezsocket_decode_distance_position(msg,dest,length);
        break;
    case _EZSOCKET_MACHINE_POSTION://机械坐标
        rc = _ezsocket_decode_machine_position(msg,dest,length);
        break;
    case _EZSOCKET_SPINDLE_SET_SPEED://主轴设定速度
        rc = _ezsocket_decode_spindle_set_speed(msg,dest,length);
        break;
    case _EZSOCKET_SPINDLE_ACTUAL_SPEED://主轴实际速度
        rc = _ezsocket_decode_spindle_act_speed(msg,dest,length);
        break;
    case _EZSOCKET_FEED_SET_SPEED://进给设定速度
        rc = _ezsocket_decode_feed_set_speed(msg,dest,length);
        break;
    case _EZSOCKET_FEED_ACTUAL_SPEED://进给实际速度
        rc = _ezsocket_decode_feed_act_speed(msg,dest,length);
        break;
    case _EZSOCKET_SPINDLE_LOAD://主轴负载
        rc = _ezsocket_decode_spindle_load(msg,dest,length);
        break;
    case _EZSOCKET_SERVO_LOAD://伺服轴负载
        rc = _ezsocket_decode_servo_load(msg,dest,length);
        break;
    case _EZSOCKET_SERVO_SPEED://伺服轴负载
        rc = _ezsocket_decode_servo_speed(msg,dest,length);
        break;
        /* 刀具相关 */
    case _EZSOCKET_MAG_TOOL_NO://刀库刀具号
        rc = _ezsocket_decode_mag_tool_no(msg,dest,length);
        break;
    case _EZSOCKET_SPD_TOOL_NO://主轴刀具号
        rc = _ezsocket_decode_spd_tool_no(msg,dest,length);
        break;
    case _EZSOCKET_TOOLOFFSET_D_SHAPE://刀具补偿D SHAPE
        rc = _ezsocket_decode_tool_offset_d_shape(msg,dest,length);
        break;
    case _EZSOCKET_TOOLOFFSET_D_WEAR://刀具补偿D WEAR
        rc = _ezsocket_decode_tool_offset_d_wear(msg,dest,length);
        break;
    case _EZSOCKET_TOOLOFFSET_H://刀具补偿H
        rc = _ezsocket_decode_tool_offset_h(msg,dest,length);
        break;
    case _EZSOCKET_TOOL_SET_SIZE://刀具数量
        rc = _ezsocket_decode_tool_set_size(msg,dest,length);
        break;
    case _EZSOCKET_TOOL_OFFSET_TYPE://刀具补偿得类型
        rc = _ezsocket_decode_tool_offset_type(msg,dest,length);
        break;
    case _EZSOCKET_TOOL_OFFSET_VALUE://刀具补偿值
        rc = _ezsocket_decode_tool_offset_value(msg,dest,length);
        break;
        /* 模态相关 */
    case _EZSOCKET_M_COMMAND://M COMMAND
        rc = _ezsocket_decode_m_command(msg,dest,length);
        break;
    case _EZSOCKET_S_COMMAND://S COMMAND
        rc = _ezsocket_decode_s_command(msg,dest,length);
        break;
    case _EZSOCKET_T_COMMAND://T COMMAND
        rc = _ezsocket_decode_t_command(msg,dest,length);
        break;
    case _EZSOCKET_B_COMMAND://B COMMAND
        rc = _ezsocket_decode_b_command(msg,dest,length);
        break;
        /* 报警相关 */
    case _EZSOCKET_ALARM_MSG://报警信息
        rc = _ezsocket_decode_alarm_msg(msg,dest,length);
        break;
        /* PLC 相关 */
    case _EZSOCKET_PLC_X://PLC X
        rc = _ezsocket_decode_plc_x(msg,dest,length);
        break;
    case _EZSOCKET_PLC_Y://PLC Y
        rc = _ezsocket_decode_plc_x(msg,dest,length);
        break;
    case _EZSOCKET_PLC_R://PLC R
        rc = _ezsocket_decode_plc_r(msg,dest,length);
        break;
    case _EZSOCKET_PLC_F://PLC F
        rc = _ezsocket_decode_plc_f(msg,dest,length);
        break;
    case _EZSOCKET_PLC_D://PLC D PLC的数据库存储区
        rc = _ezsocket_decode_plc_d(msg,dest,length);
        break;
    case _EZSOCKET_G_CODE://G代码
        rc = _ezsocket_decode_g_code(msg,dest,length);
        break;
        /* 参数相关 */
    case _EZSOCKET_PARAM_READ://参数读取
        rc = _ezsocket_decode_param_read(msg,dest,length);
        break;
        /* 宏变量 */
    case _EZSOCKET_READ_MACRO_VAR://读取宏变量
        rc = _ezsocket_decode_read_macro_var(msg,dest,length);
        break;
    case _EZSOCKET_WRITE_MACRO_VAR://写宏变量

        break;
    default:
        break;
    }
    return rc;
}

const ezsocket_backend_t _ezsocket_backend = {
    _EZSOCKET_HEADER_LENGTH,
    _EZSOCKET_MAX_ADU_LENGTH,
    _ezsocket_build_request_basis,
    _ezsocket_receive_msg,
    _ezsocket_decode_msg,
    _ezsocket_tcp_send,
    _ezsocket_tcp_recv,
    _ezsocket_tcp_connect,
    _ezsocket_tcp_close,
    _ezsocket_tcp_flush,
    _ezsocket_tcp_select
};

/*
*********************************************************************************************************
*	函 数 名: ezsocket_new
*	功能说明: 初始化ezsocket协议
*	形    参: const char *ip_address, int port
*	返 回 值: ezsocket_t*
*********************************************************************************************************
*/
ezsocket_t *ezsocket_new(const char *ip, int port)
{
    ezsocket_t *ctx;
    ezsocket_tcp_t *ctx_tcp;
    int dest_size;
    int ret_size;
    ctx = (ezsocket_t *) malloc(sizeof(ezsocket_t));
    _ezsocket_init_common(ctx);

    ctx->backend = &(_ezsocket_backend);
    ctx->backend_data = (ezsocket_tcp_t *) malloc(sizeof(ezsocket_tcp_t));
    ctx_tcp =  (ezsocket_tcp_t *)ctx->backend_data;
    dest_size = sizeof(char) * 16;
    ret_size = _ezsocket_strlcpy(ctx_tcp->ip, ip, dest_size);
    if (ret_size == 0) {
        fprintf(stderr, "The IP string is empty\n");
        ezsocket_free(ctx);
        errno = EINVAL;
        return NULL;
    }

    if (ret_size >= dest_size) {
        fprintf(stderr, "The IP string has been truncated\n");
        ezsocket_free(ctx);
        errno = EINVAL;
        return NULL;
    }

    ctx_tcp->port = port;

    return ctx;
}
